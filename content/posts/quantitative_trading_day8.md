---
title: "量化交易入门指南：第8天 资产配置与均值-方差理论（Mean-Variance Theory）"
date: 2025-06-09
draft: false
description: "深入理解现代投资组合理论的核心 - 均值-方差理论，包括投资组合收益与风险的数学表示、协方差与波动性、Markowitz有效前沿等核心概念"
tags: ["投资组合", "量化投资", "风险管理", "资产配置"]
categories: ["量化投资"]
author: "徐亚飞"
showToc: true
TocOpen: true
weight: 10
---

# 资产配置与均值-方差理论（Mean-Variance Theory）

这是现代投资组合理论的核心。它不仅是基金经理配置资产的基础，也是量化多资产策略、ETF构建、风险平衡策略（如风险平价）等模型的出发点。

##  学习目标

理解以下核心内容：
1. 投资组合收益与风险的数学表示
2. 投资组合的协方差与波动性
3. Markowitz 均值-方差理论（有效前沿）
4. 无风险资产的引入 & 最优资产配置线（CAL）
5. Python 代码实践（手动或附带代码）

##  理论学习

###  1.组合收益和风险如何计算？

假设你有两个资产 A, B，权重分别为 $w_A$, $w_B$，期望收益为 $E[R_A]$, $E[R_B]$，波动率为 $\sigma_A$, $\sigma_B$，协方差为 $\text{Cov}(A,B)$

组合预期收益：

$$E[R_p] = w_A E[R_A] + w_B E[R_B]$$

组合方差（风险）：

$$\sigma_p^2 = w_A^2 \sigma_A^2 + w_B^2 \sigma_B^2 + 2w_Aw_B \cdot \text{Cov}(A,B)$$

如果有多个资产（如 n 个），就扩展成协方差矩阵形式：

$$\sigma_p^2 = \mathbf{w}^T \Sigma \mathbf{w}$$

###  2.组合期望收益是怎么计算的？

"期望是怎么计算的"，意思是：我们怎么得到 $E[R_A]$, $E[R_B]$？

答案是：基于历史数据或未来预期来估算的。

例如：
- 如果用历史平均：
$$E[R_A] = \frac{1}{T} \sum_{t=1}^{T} R_{A,t}$$
其中 $R_{A,t}$ 是第 t 期的实际收益率。
- 如果是基于分析师预测、基本面判断，可以人为设定一个预期收益。

###  3.波动率是固定的吗？

不是"固定的"，而是基于一段历史数据估算的，并且会随着数据更新不断变化。

波动率$\sigma$本质上是收益率的标准差：

$$\sigma_A = \sqrt{\frac{1}{T-1} \sum_{t=1}^{T} \left(R_{A,t} - E[R_A]\right)^2}$$

- 它衡量的是收益的"上下波动性"。
- 波动越大，风险越高。

 注意：波动率是用对数收益率还是线性收益率都可以，但要保持一致。

###  4.协方差怎么计算的？

协方差公式是：

$$\text{Cov}(A, B) = \frac{1}{T-1} \sum_{t=1}^{T} (R_{A,t} - E[R_A]) (R_{B,t} - E[R_B])$$

- 它衡量的是：两个资产收益变动之间的关系
- 正协方差：同涨同跌
- 负协方差：一个涨一个跌
- 协方差 = 0：互不相关

协方差可以换算成"相关系数"：

$$\rho_{A,B} = \frac{\text{Cov}(A,B)}{\sigma_A \sigma_B}$$
$$\quad \Rightarrow \quad$$
$$\text{Cov}(A,B) = \rho_{A,B} \cdot \sigma_A \cdot \sigma_B$$

###  5.为什么要计算协方差？

因为协方差是组合风险不可忽略的一部分。

组合的整体波动不仅取决于每个资产自身的波动，还取决于它们之间是否"同步波动"。

来看下组合方差的公式：

$$\sigma_p^2 = w_A^2 \sigma_A^2 + w_B^2 \sigma_B^2 + 2w_A w_B \cdot \text{Cov}(A,B)$$

➤ 解释：
- 前两项：分别是 A、B 各自的风险。
- 最后一项：是组合中由于资产之间的联动带来的额外风险或抵消效果。

举例：
- 如果两个资产相关性是 -1，你可以组合出几乎"无波动"的投资（理论最小方差）。
- 如果两个资产完全正相关，你的组合波动不会被降低。

所以：

资产之间的协方差（或相关性）越低，组合分散风险的效果越好。

这就是"不要把鸡蛋放在一个篮子里"的数学基础。

###  6.多个资产的协方差矩阵形式

对于多个资产 n，你就不能一个个手工算了，要用矩阵：
- 权重向量：
$$\mathbf{w} = \begin{bmatrix} w_1 \\ w_2 \\ \vdots \\ w_n \end{bmatrix}$$
- 协方差矩阵：
$$\Sigma =
\begin{bmatrix}
\sigma_1^2 & \text{Cov}{1,2} & \cdots & \text{Cov}{1,n} \\
\text{Cov}{2,1} & \sigma_2^2 & \cdots & \text{Cov}{2,n} \\
\vdots & \vdots & \ddots & \vdots \\
\text{Cov}{n,1} & \text{Cov}{n,2} & \cdots & \sigma_n^2
\end{bmatrix}$$
- 组合方差公式（矩阵形式）：
$$\sigma_p^2 = \mathbf{w}^T \Sigma \mathbf{w}$$

你可以用 Excel 或 Python numpy 很方便地实现这个计算。

###  7.总结一句话

期望收益衡量你希望赚多少，波动率衡量一个资产自身有多不稳定，
协方差衡量资产之间是否"同时跳动"，
三者共同决定你的投资组合是否稳健、是否值得投入。

##  二、Markowitz 均值-方差理论（Mean-Variance Frontier）

在给定的风险水平下，找到能带来最高期望收益的投资组合
或者在给定收益目标下，找到风险最小的组合

这就构成了所谓的：

 有效前沿（Efficient Frontier）

 一条向上的"边界线"，表示在不同风险水平下最优的资产组合。

###  1. 背景与目标：资产组合优化的本质

假设你有多个投资对象（如股票、基金、债券等），你希望在控制风险的前提下，获得尽可能高的收益。

Markowitz 的思想核心就是：

 收益越高越好，风险越低越好
 但二者存在权衡：收益越高，风险往往越大。

于是，我们的目标转化为：
- 在固定风险水平下，找期望收益最高的组合
- 或者 在固定收益目标下，找风险最小的组合

###  2. 可行集合（Feasible Set）

先假设你知道所有资产的：
- 期望收益 $E[R_i]$
- 风险（标准差） $\sigma_i$
- 两两之间的协方差 $\text{Cov}(R_i, R_j)$

你可以通过不同的权重组合 $$\mathbf{w} = [w_1, w_2, …, w_n]$$ 构造出许多组合，每个组合都有：
- 一个期望收益 $$E[R_p] = \sum w_i E[R_i]$$
- 一个组合风险 $$\sigma_p = \sqrt{\mathbf{w}^T \Sigma \mathbf{w}}$$

 把所有这些组合画在二维坐标系里（x轴是风险，y轴是收益），你就得到一个"抛物线形的图" —— 这叫做可行集合。

###  3. 有效前沿（Efficient Frontier）

在这个"抛物线形区域"的上边界，就是 Markowitz 所定义的：

 有效前沿（Efficient Frontier）

它包含了所有在给定风险水平下，期望收益最高的投资组合。

特点：
- 所有有效组合都在这条边界上
- 边界以下的组合，要么收益低，要么风险高 —— 非最优
- 这条边界线通常是向上弯曲的（凸的）

###  4. 最左边的点：最小方差组合（Minimum Variance Portfolio）

在所有组合中，风险（方差）最小的是哪一个？

 就是 有效前沿最左侧的那一点，称为：

 Minimum Variance Portfolio（MVP）

它的特点是：
- 不管你是否追求高收益，它无条件风险最小
- 通常是分散投资效果最强的组合
- 有时候收益也不错，但不是最优收益

###  5. 再引入无风险资产后（Capital Market Line）

如果市场中存在一个无风险资产（如国债），你还可以：
- 和有效前沿上的某一点做一条切线
- 找到一条叫做 资本市场线（CML） 的直线
- 它的切点就是市场组合（Market Portfolio），夏普比率最大

 这是 CAPM 的基础，可以之后扩展讲。

###  6. 小结：图像理解

你可以把整个 Markowitz 均值-方差理论理解为：
```
收益 ^
      |
      |                   *      ← 高收益但风险高（非有效组合）
      |               *
      |            *
      |         *
      |      *
      |   *
      |* ← 最小方差组合 MVP（风险最小）
      +--------------------------> 风险（标准差）
```

- *表示有效前沿上的组合
- 最左边那点风险最低
- 你选组合的位置，取决于你对风险和收益的偏好（风险厌恶程度）

##  三、引入无风险资产：资本配置线（CAL）

当你能投资于一个无风险资产（如国债）和一个风险资产组合时：
- 整个有效前沿不再是曲线，而变成一条直线
- 最陡的那条线，即为资本配置线（Capital Allocation Line），斜率就是 Sharpe Ratio

 投资组合理论的目标就是找到那条最陡的 CAL，其与有效前沿相切的点，称为：

 最优风险投资组合（Tangency Portfolio） 

###  1.先回顾：没有无风险资产时的有效前沿

我们已经知道：
- 有 n 个风险资产，比如股票、基金等
- 通过不同的权重组合，构建出各种投资组合
- 把这些组合在二维坐标系（风险 σ，期望收益 E[R]）上画出来，形成一个"向上凸的边界曲线"，那是：

 有效前沿（Efficient Frontier）

###  2.现在引入一个无风险资产

比如：短期国债，固定收益 3%，标准差为 0（无波动）

我们现在可以干一件以前不能做的事：

 把"无风险资产" 和 "任何风险资产组合" 做加权投资！

例如：
- 投资组合 = 50% 无风险资产（如年化 3%）
- 50% 风险资产（如股票组合年化 8%，σ = 15%）

那整体组合的：
- 预期收益 = 0.5 × 3% + 0.5 × 8% = 5.5%
- 风险 = 0.5 × 15% = 7.5% （因为无风险资产波动是 0）

 注意：风险线性增长，收益也线性增长！
这说明：你在两个资产间做线性组合，最终结果也落在一条直线上。

###  3.这就是"资本配置线（CAL）"

如果你：
- 把无风险资产当作左端点
- 另一端是某个风险投资组合
- 你就可以在这两点之间做任意线性组合（例如 30/70, 60/40 等）

 那么：

 所有这些组合就落在一条穿过无风险收益点、延伸到风险资产组合的直线上，这条线就是：

 资本配置线（CAL, Capital Allocation Line）

###  4.为什么我们要找"最陡的"那条线？

因为：
- 线的斜率 = 单位风险所获得的超额收益

$$\text{CAL 斜率} = \frac{E[R_p] - R_f}{\sigma_p} = \text{Sharpe Ratio}$$
- 所以我们希望这条线尽可能"陡"，代表单位波动带来最多收益！

 结论：

 找到和有效前沿"相切"的 CAL，就是找到单位风险回报比（Sharpe）最大的投资组合！

这个切点对应的组合就是：

 切点投资组合（Tangency Portfolio）
- 它是所有风险资产中最优的"基础组合"
- 投资者可以根据自己的风险偏好，在这条线上的不同点做组合（加杠杆或持有部分国债）

###  5.图像理解：
```
收益 ^
      |
      |        *             ← 有效前沿（风险资产组合）
      |      *    *
      |    *        *
      |  *             *
      |*------------------------→ 风险
     Rf                ↑
       \               |
        \              |
         \             | ← 资本配置线（CAL）
          \            |   ← 最优切点组合
           \___________|
```

- Rf：无风险资产
- CAL：从 Rf 向右画出的那条穿过切点组合的直线
- 最陡的 CAL → 对应 Sharpe Ratio 最大

###  6.总结

| 概念 | 含义 |
|------|------|
| 无风险资产 | 固定收益、零波动，如国债 |
| 资本配置线 CAL | 投资组合 = 无风险资产 + 风险组合 |
| CAL 斜率 | Sharpe Ratio，单位波动带来的超额收益 |
| 切点组合 | Sharpe 最大，最优风险投资组合 |
| 投资选择 | 你可以在 CAL 上移动，根据风险承受能力选择组合 | 

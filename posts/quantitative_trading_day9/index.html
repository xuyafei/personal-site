<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） | 我的博客</title><meta name=keywords content="量化交易,多因子,选股模型,Alpha,因子投资,Python实战"><meta name=description content="量化交易学习系列第9天：系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。"><meta name=author content="徐亚飞"><link rel=canonical href=https://xuyafei.github.io/personal-site/posts/quantitative_trading_day9/><link crossorigin=anonymous href=/personal-site/assets/css/stylesheet.93f625d739f1d6a5c6f20c146bc6a8d26b233492b34b2220c54b12fd46a04ded.css integrity="sha256-k/Yl1znx1qXG8gwUa8ao0msjNJKzSyIgxUsS/UagTe0=" rel="preload stylesheet" as=style><link rel=icon href=https://xuyafei.github.io/personal-site/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xuyafei.github.io/personal-site/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xuyafei.github.io/personal-site/favicon-32x32.png><link rel=apple-touch-icon href=https://xuyafei.github.io/personal-site/apple-touch-icon.png><link rel=mask-icon href=https://xuyafei.github.io/personal-site/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xuyafei.github.io/personal-site/posts/quantitative_trading_day9/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAYQHy+K8nqKdr1EzvFzSQC+TAXx6gNQgoRxKtj+P9vvCCQTRWiV crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script><script>MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta property="og:url" content="https://xuyafei.github.io/personal-site/posts/quantitative_trading_day9/"><meta property="og:site_name" content="我的博客"><meta property="og:title" content="量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）"><meta property="og:description" content="量化交易学习系列第9天：系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-24T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-24T00:00:00+00:00"><meta property="article:tag" content="量化交易"><meta property="article:tag" content="多因子"><meta property="article:tag" content="选股模型"><meta property="article:tag" content="Alpha"><meta property="article:tag" content="因子投资"><meta property="article:tag" content="Python实战"><meta name=twitter:card content="summary"><meta name=twitter:title content="量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）"><meta name=twitter:description content="量化交易学习系列第9天：系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"文章","item":"https://xuyafei.github.io/personal-site/posts/"},{"@type":"ListItem","position":2,"name":"量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）","item":"https://xuyafei.github.io/personal-site/posts/quantitative_trading_day9/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）","name":"量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）","description":"量化交易学习系列第9天：系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。","keywords":["量化交易","多因子","选股模型","Alpha","因子投资","Python实战"],"articleBody":"量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） 学习时间：60分钟\n本文为量化交易学习系列第9天内容，系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。\n今日目标 你将掌握：\n什么是\"因子\"（Factor）？ 常见的因子类别和含义 多因子模型的组合方式 用 Python 实现一个简单的多因子评分系统 如何从\"因子\"走向\"策略\"？ 一、为什么是\"Alpha 策略\"？ 在量化投资中，理解\"Alpha\"和\"Beta\"是构建选股策略的基础。\nAlpha（α）：资产的超额收益，即超出市场基准（如标普500、沪深300）的收益。 Beta（β）：资产对市场整体波动的敏感性（系统性风险），如市场涨1%，你的组合涨1.2%，Beta≈1.2。 Alpha 策略：通过研究、建模等手段，获取\"额外收益\"的策略，这种收益不是因为市场整体上涨，而是因为你\"选股（择时）能力强\"。 目标： Alpha 策略的目标是击败市场基准，赚取额外收益。\n二、为什么用\"因子\"来构建 Alpha 策略？ 股票价格的变化并非完全随机，而是受到一系列可量化的驱动因子（Factor）影响：\n价值因子（Value）：低市盈率、市净率的股票长期表现更好； 动量因子（Momentum）：过去表现好的股票短期内更可能继续上涨； 质量因子（Quality）：高盈利能力、低负债率的公司长期表现更稳健； 小市值因子（Size）：小盘股有时能跑赢大盘股； 波动率因子（Volatility）：低波动率的股票长期有超额收益。 这些\"因子\"就是预测股票收益的解释变量，是量化选股的基础。\nAQR、Two Sigma、桥水等顶级量化机构的核心能力，就是围绕因子构建出组合稳定、风险可控、长期有效的 Alpha 策略。\n三、Alpha 策略 vs Beta 策略 对比项 Alpha 策略 Beta 策略 目标 超越市场收益（择股择时） 复制市场收益（持有指数） 收益来源 股票的相对表现（选得好） 市场整体上涨（靠大盘） 代表产品 多因子选股策略、统计套利 ETF、指数基金 难度 高（需要建模、预测） 低（只需跟随指数） 小结： 量化基金用\"多个因子\"预测股票收益，是为了追求 Alpha（超额收益），而不是简单追踪市场（Beta）。\n四、什么是因子（Factor）？ 在量化中，因子是能够系统性解释资产收益差异的特征变量。\n举例：\n市盈率（PE）低的股票平均表现更好（价值因子） 最近上涨的股票更容易继续上涨（动量因子） 因子不是噪声，而是\"能预测部分收益的结构性信息\"。\n五、常见因子分类（五大类） 因子类型 示例因子 含义 价值因子 PE、PB、EV/EBITDA 低估值股票长期跑赢 动量因子 3个月涨幅、6月收益 趋势延续效应 质量因子 ROE、净利润率 高质量企业表现稳定 规模因子 市值、总资产 小市值公司长期有超额收益 波动/风险因子 波动率、Beta、最大回撤 低波动股票可能更优（Low Vol） 六、单因子 vs 多因子模型 单因子模型：只使用一个因子排序选股，简单但容易失效。 多因子模型：多个因子融合打分，更稳定、抗噪音。 多因子融合方法举例： Z-score 归一化后加权求和 PCA 主成分分析 机器学习模型：XGBoost、线性回归、Random Forest 等 1. Z-score 加权求和法（标准化加权法） 原理：\n各因子的量纲、尺度不同（如 PE 是几十，动量是百分比），需归一化处理； Z-score 是最常见的标准化方式： $$ Z_i = \\frac{x_i - \\mu}{\\sigma} $$\n其中 $x_i$ 是某只股票在该因子的原始值，$\\mu$ 和 $\\sigma$ 是该因子的均值和标准差。\n多个标准化后的因子 $Z_1, Z_2, …, Z_n$ 再根据权重 $w_1, w_2, …, w_n$ 加权求和： $$ \\text{Score}i = \\sum{j=1}^{n} w_j \\cdot Z_{ij} $$\n应用步骤：\n选取多个有效因子（如动量、价值、波动率、质量等）； 对每个因子做 Z-score 处理（在横截面标准化）； 为每个因子设置权重（可手动设定或用历史绩效决定）； 对每只股票打分（加权求和）并排序，构建组合。 优点：\n简单直观，便于解释； 不需要复杂算法，容易实施； 控制权重可以加入\"主观判断\"。 缺点：\n因子权重是静态或拍脑袋设的； 无法自动适应市场风格变化； 因子间的冗余、相关性未处理。 2. PCA 主成分分析（降维融合法） 原理：\nPCA 是一种无监督降维算法，用于从多个相关变量中提取最核心的无关成分，即\"主成分\"。 在多因子选股中，PCA 用于提取综合打分的主方向，减少冗余信息。 操作流程：\n对每个因子进行 Z-score 标准化； 构造因子矩阵 X：每行是股票，每列是因子； 对 X 做协方差矩阵计算，求解特征值和特征向量； 保留前几个主成分（解释了大部分信息），得到： $$ \\text{PC}_1 = \\sum_j w_j \\cdot Z_j $$\n第一个主成分通常作为\"综合因子分数\"； 5. 用 PC1 排序选股。\n优点：\n自动识别最重要的信息方向； 可剔除冗余或高相关因子； 非人为设定权重，数据驱动。 缺点：\n主成分权重不可解释（变成了组合线性项）； 主成分不一定有经济含义； 假设数据服从线性结构，非线性无效。 3. 机器学习模型融合（非线性方法） 原理：\n使用机器学习模型（如 XGBoost、Random Forest、线性回归等）来学习因子与\"未来收益\"之间的映射关系。 因子作为特征，未来收益为标签，训练模型得到预测器。 应用流程：\n构建训练集： 特征：多因子横截面数据（如动量、估值、盈利质量等）； 标签：未来 n 天/1 个月收益率； 选模型（XGBoost、随机森林、逻辑回归、SVM等）； 训练模型并交叉验证； 在预测期使用模型输出股票\"预期收益\" → 排序建仓； 定期更新模型或重新训练。 优点： 可自动学习非线性、交互项；可以挖掘隐藏结构（如哪个因子在当前市场更有效）；灵活且可与大数据结合。\n缺点： 黑箱模型，不易解释；容易过拟合（尤其样本小/特征多）；需要更强算力、数据、调参经验。\n总结比较 方法 原理 优点 缺点 适用场景 Z-score加权 标准化 + 权重加总 简单易用、可控 无法自适应、冗余多 初学者、快速测试 PCA降维 降维提主成分 自动识别核心成分 不可解释、假设线性 有多个高相关因子时 机器学习 学习因子→收益映射 可建复杂非线性模型 黑箱+易过拟合 大数据、实盘策略 七、因子挖掘流程（实战视角） 1️⃣ 构建因子库 目的：从多个维度（财务/市场/行为）系统收集可能有效的特征变量，为后续筛选打基础。 数据来源：Tushare Pro、Wind、聚宽、RiceQuant 数据频率：财务因子用季度数据，行情因子用日频或周频 因子类型： 财务类：PE、PB、ROE、营收增长等 行情类：动量（近3月涨幅）、波动率、换手率等 行为类：新闻情绪、基金调仓轨迹、龙虎榜等 2️⃣ 标准化处理 目的：将不同量纲的因子统一为可比较的标准格式，并处理异常值，消除极端影响。 常见方法： Z-score：$z = \\frac{x - \\mu}{\\sigma}$，转为标准正态分布 Min-Max：将值压缩到[0, 1]区间 去极值（winsorize）：截断极端值（如1%、99%） 行业/市值中性化：消除行业结构或市值对因子的影响 3️⃣ 单因子测试 目的：判断某个单因子是否具备预测未来收益的能力（alpha 信息含量）。 常用检验方法： 分组收益法：将股票按因子打分分组，比较高组 vs 低组未来收益 IC（信息系数）：因子值与未来收益的 Spearman 相关系数 IR（信息比率）：$IR = \\frac{\\text{年化因子组合超额收益}}{\\text{年化波动}}$ T检验：高分组收益是否显著大于低分组 判断标准： IC \u003e 0.02 一般认为有效，\u003e 0.05 较强 分组图呈现\"单调结构\"最佳（高分组 \u003e 中 \u003e 低） 4️⃣ 因子组合评分 目的：融合多个有效因子，提高策略稳定性，减少\"因子漂移\"与\"失效风险\"。 融合方法： Z-score加权、PCA、机器学习模型、IC加权组合 输出结果：每只股票得到一个\"多因子评分\"，用于排序选股。 5️⃣ 选股 + 回测 + 组合优化 目的：用因子评分排序，选出前 N 名股票构建组合，并通过回测评估其历史表现。 选股逻辑：每期取评分排名前 5%、10%、20% 的股票，可设定行业、市值中性化约束 回测核心指标：年化收益率、夏普比率、最大回撤、胜率、换手率 组合优化：等权、风险平价、最小方差、均值-方差优化 6️⃣ 部署策略 or 实盘监控 目的：将策略落地运行在实际环境中，观察表现、调优及风控。 工具推荐：Tushare Pro、RiceQuant、聚宽、backtrader、Qlib、Pyfolio、EasyTrader、vn.py 常见实盘问题：板块轮动、高换手、滞后问题 小结： 因子挖掘的流程是一个从信息提取 → 信号验证 → 策略集成 → 交易落地的完整闭环，每一步都强调数据严谨性、统计显著性与执行可行性。\n八、Python 实战：多因子评分系统 我们实现一个简化版的多因子评分系统，用于选出\"优质股票\"。\n步骤：使用财务数据构建三因子打分系统（价值 + 质量 + 动量）\nimport pandas as pd from sklearn.preprocessing import StandardScaler # 假设有一个DataFrame，每一行是股票，每一列是因子 data = pd.DataFrame({ 'stock': ['A', 'B', 'C', 'D'], 'pe': [10, 25, 15, 8], # 价值因子（越低越好） 'roe': [12, 15, 8, 20], # 质量因子（越高越好） 'momentum': [0.1, 0.05, -0.02, 0.15] # 动量因子（越高越好） }) data.set_index('stock', inplace=True) # 标准化处理 scaler = StandardScaler() factors = ['pe', 'roe', 'momentum'] data_std = pd.DataFrame(scaler.fit_transform(data[factors]), columns=factors, index=data.index) # 注意：pe 低才好，要取负值 data_std['pe'] = -data_std['pe'] # 简单平均打分 data_std['score'] = data_std.mean(axis=1) # 排序选股 print(data_std.sort_values('score', ascending=False)) 分析：哪只股票综合表现最好？如果选 Top 2，会是哪两只？\n九、思考题（理解因子选股核心） 1️⃣ 为什么单因子策略容易\"失效\"？ 原因类型 具体解释 拥挤交易 市场大量资金使用同一因子，超额收益被套利抹平 因子周期性 因子效果存在周期，某些阶段有效，某些阶段失效 结构变化 宏观政策、估值体系或行业逻辑改变导致因子失效 缺乏稳健性 单因子抗干扰能力差，易受极端数据或短期波动影响 比如：动量因子在牛市中表现亮眼，但熊市中反转频繁，效果可能变差。\n2️⃣ 如何判断一个因子是否\"有效\"？ 检验维度 检验方法 信息比率（IR） IR = 年化超额收益 / 年化跟踪误差，越高越好 IC（信息系数） 因子与未来收益的 Spearman/Pearson 相关系数，IC \u003e 0.02 通常有效 分层回测 因子分组，检验高分组是否优于低分组 横截面回归 因子解释横截面收益，t值 \u003e 2 更好 稳定性与可迁移性 不同时间、行业、市场是否仍有效 3️⃣ 如果两个因子高度相关，组合时会出现什么问题？ 问题类型 说明 冗余信息 反复加入相似信息不会提升预测效果，只会放大权重偏差 权重不稳 回归模型中权重会变得不稳定、容易过拟合 噪声放大 相关因子的误差可能会相互强化而非抵消 示例：若用\"PB\"和\"PE\"作为两个因子，这两者都高度相关于\"估值\"，组合后并不会真正多样化。 解决方案：相关性检测、降维（PCA）、删除冗余因子 4️⃣ 动量因子是否会在极端行情中失效？ 是的，动量因子典型地在极端行情中\"反转失效\"。\n市场阶段 动量表现 趋势强烈（牛市） 非常有效，顺势上涨 震荡市/横盘市 失效，涨跌反复，信号混乱 极端转折点 严重失效，强势股被快速抛售 举例： 2020年3月疫情冲击，之前涨得猛的股票（如科技股）出现剧烈回调，动量策略遭遇大幅回撤。 2008金融危机也是动量策略失效的典型案例。 应对方式：加入风险控制、设置切换机制、动量+反转/低波动等多因子组合增强稳定性 十、小结 内容 你应掌握的知识 因子是什么 能解释收益差异的特征变量 因子分类 价值、质量、动量、波动、规模 多因子组合 标准化 → 加权 → 打分 → 选股 Python 实战 简单实现 Z-score 多因子评分 通过今天的学习，你已经掌握了多因子选股模型的核心原理、实战流程与Python实现。下一讲我们将进入\"量化回测与风险管理\"的世界，敬请期待！\n","wordCount":"503","inLanguage":"en","datePublished":"2025-06-24T00:00:00Z","dateModified":"2025-06-24T00:00:00Z","author":{"@type":"Person","name":"徐亚飞"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xuyafei.github.io/personal-site/posts/quantitative_trading_day9/"},"publisher":{"@type":"Organization","name":"我的博客","logo":{"@type":"ImageObject","url":"https://xuyafei.github.io/personal-site/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xuyafei.github.io/personal-site/ accesskey=h title="我的博客 (Alt + H)">我的博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://xuyafei.github.io/personal-site/categories/ title=分类><span>分类</span></a></li><li><a href=https://xuyafei.github.io/personal-site/tags/ title=标签><span>标签</span></a></li><li><a href=https://xuyafei.github.io/personal-site/archives/ title=归档><span>归档</span></a></li><li><a href=https://xuyafei.github.io/personal-site/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://xuyafei.github.io/personal-site/>Home</a>&nbsp;»&nbsp;<a href=https://xuyafei.github.io/personal-site/posts/>文章</a></div><h1 class="post-title entry-hint-parent">量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）</h1><div class=post-description>量化交易学习系列第9天：系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。</div><div class=post-meta><span title='2025-06-24 00:00:00 +0000 UTC'>June 24, 2025</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;徐亚飞</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%e7%ac%ac9%e5%a4%a9---%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8bfactor-investing aria-label="量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）">量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）</a><ul><li><a href=#%e4%bb%8a%e6%97%a5%e7%9b%ae%e6%a0%87 aria-label=今日目标>今日目标</a></li><li><a href=#%e4%b8%80%e4%b8%ba%e4%bb%80%e4%b9%88%e6%98%afalpha-%e7%ad%96%e7%95%a5 aria-label='一、为什么是"Alpha 策略"？'>一、为什么是"Alpha 策略"？</a></li><li><a href=#%e4%ba%8c%e4%b8%ba%e4%bb%80%e4%b9%88%e7%94%a8%e5%9b%a0%e5%ad%90%e6%9d%a5%e6%9e%84%e5%bb%ba-alpha-%e7%ad%96%e7%95%a5 aria-label='二、为什么用"因子"来构建 Alpha 策略？'>二、为什么用"因子"来构建 Alpha 策略？</a></li><li><a href=#%e4%b8%89alpha-%e7%ad%96%e7%95%a5-vs-beta-%e7%ad%96%e7%95%a5 aria-label="三、Alpha 策略 vs Beta 策略">三、Alpha 策略 vs Beta 策略</a></li><li><a href=#%e5%9b%9b%e4%bb%80%e4%b9%88%e6%98%af%e5%9b%a0%e5%ad%90factor aria-label=四、什么是因子（Factor）？>四、什么是因子（Factor）？</a></li><li><a href=#%e4%ba%94%e5%b8%b8%e8%a7%81%e5%9b%a0%e5%ad%90%e5%88%86%e7%b1%bb%e4%ba%94%e5%a4%a7%e7%b1%bb aria-label=五、常见因子分类（五大类）>五、常见因子分类（五大类）</a></li><li><a href=#%e5%85%ad%e5%8d%95%e5%9b%a0%e5%ad%90-vs-%e5%a4%9a%e5%9b%a0%e5%ad%90%e6%a8%a1%e5%9e%8b aria-label="六、单因子 vs 多因子模型">六、单因子 vs 多因子模型</a><ul><li><a href=#%e5%a4%9a%e5%9b%a0%e5%ad%90%e8%9e%8d%e5%90%88%e6%96%b9%e6%b3%95%e4%b8%be%e4%be%8b aria-label=多因子融合方法举例：>多因子融合方法举例：</a></li><li><a href=#1-z-score-%e5%8a%a0%e6%9d%83%e6%b1%82%e5%92%8c%e6%b3%95%e6%a0%87%e5%87%86%e5%8c%96%e5%8a%a0%e6%9d%83%e6%b3%95 aria-label="1. Z-score 加权求和法（标准化加权法）">1. Z-score 加权求和法（标准化加权法）</a></li><li><a href=#2-pca-%e4%b8%bb%e6%88%90%e5%88%86%e5%88%86%e6%9e%90%e9%99%8d%e7%bb%b4%e8%9e%8d%e5%90%88%e6%b3%95 aria-label="2. PCA 主成分分析（降维融合法）">2. PCA 主成分分析（降维融合法）</a></li><li><a href=#3-%e6%9c%ba%e5%99%a8%e5%ad%a6%e4%b9%a0%e6%a8%a1%e5%9e%8b%e8%9e%8d%e5%90%88%e9%9d%9e%e7%ba%bf%e6%80%a7%e6%96%b9%e6%b3%95 aria-label="3. 机器学习模型融合（非线性方法）">3. 机器学习模型融合（非线性方法）</a></li><li><a href=#%e6%80%bb%e7%bb%93%e6%af%94%e8%be%83 aria-label=总结比较>总结比较</a></li></ul></li><li><a href=#%e4%b8%83%e5%9b%a0%e5%ad%90%e6%8c%96%e6%8e%98%e6%b5%81%e7%a8%8b%e5%ae%9e%e6%88%98%e8%a7%86%e8%a7%92 aria-label=七、因子挖掘流程（实战视角）>七、因子挖掘流程（实战视角）</a><ul><li><a href=#1-%e6%9e%84%e5%bb%ba%e5%9b%a0%e5%ad%90%e5%ba%93 aria-label="1️⃣ 构建因子库">1️⃣ 构建因子库</a></li><li><a href=#2-%e6%a0%87%e5%87%86%e5%8c%96%e5%a4%84%e7%90%86 aria-label="2️⃣ 标准化处理">2️⃣ 标准化处理</a></li><li><a href=#3-%e5%8d%95%e5%9b%a0%e5%ad%90%e6%b5%8b%e8%af%95 aria-label="3️⃣ 单因子测试">3️⃣ 单因子测试</a></li><li><a href=#4-%e5%9b%a0%e5%ad%90%e7%bb%84%e5%90%88%e8%af%84%e5%88%86 aria-label="4️⃣ 因子组合评分">4️⃣ 因子组合评分</a></li><li><a href=#5-%e9%80%89%e8%82%a1--%e5%9b%9e%e6%b5%8b--%e7%bb%84%e5%90%88%e4%bc%98%e5%8c%96 aria-label="5️⃣ 选股 + 回测 + 组合优化">5️⃣ 选股 + 回测 + 组合优化</a></li><li><a href=#6-%e9%83%a8%e7%bd%b2%e7%ad%96%e7%95%a5-or-%e5%ae%9e%e7%9b%98%e7%9b%91%e6%8e%a7 aria-label="6️⃣ 部署策略 or 实盘监控">6️⃣ 部署策略 or 实盘监控</a></li></ul></li><li><a href=#%e5%85%abpython-%e5%ae%9e%e6%88%98%e5%a4%9a%e5%9b%a0%e5%ad%90%e8%af%84%e5%88%86%e7%b3%bb%e7%bb%9f aria-label="八、Python 实战：多因子评分系统">八、Python 实战：多因子评分系统</a></li><li><a href=#%e4%b9%9d%e6%80%9d%e8%80%83%e9%a2%98%e7%90%86%e8%a7%a3%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a0%b8%e5%bf%83 aria-label=九、思考题（理解因子选股核心）>九、思考题（理解因子选股核心）</a><ul><li><a href=#1-%e4%b8%ba%e4%bb%80%e4%b9%88%e5%8d%95%e5%9b%a0%e5%ad%90%e7%ad%96%e7%95%a5%e5%ae%b9%e6%98%93%e5%a4%b1%e6%95%88 aria-label='1️⃣ 为什么单因子策略容易"失效"？'>1️⃣ 为什么单因子策略容易"失效"？</a></li><li><a href=#2-%e5%a6%82%e4%bd%95%e5%88%a4%e6%96%ad%e4%b8%80%e4%b8%aa%e5%9b%a0%e5%ad%90%e6%98%af%e5%90%a6%e6%9c%89%e6%95%88 aria-label='2️⃣ 如何判断一个因子是否"有效"？'>2️⃣ 如何判断一个因子是否"有效"？</a></li><li><a href=#3-%e5%a6%82%e6%9e%9c%e4%b8%a4%e4%b8%aa%e5%9b%a0%e5%ad%90%e9%ab%98%e5%ba%a6%e7%9b%b8%e5%85%b3%e7%bb%84%e5%90%88%e6%97%b6%e4%bc%9a%e5%87%ba%e7%8e%b0%e4%bb%80%e4%b9%88%e9%97%ae%e9%a2%98 aria-label="3️⃣ 如果两个因子高度相关，组合时会出现什么问题？">3️⃣ 如果两个因子高度相关，组合时会出现什么问题？</a></li><li><a href=#4-%e5%8a%a8%e9%87%8f%e5%9b%a0%e5%ad%90%e6%98%af%e5%90%a6%e4%bc%9a%e5%9c%a8%e6%9e%81%e7%ab%af%e8%a1%8c%e6%83%85%e4%b8%ad%e5%a4%b1%e6%95%88 aria-label="4️⃣ 动量因子是否会在极端行情中失效？">4️⃣ 动量因子是否会在极端行情中失效？</a></li></ul></li><li><a href=#%e5%8d%81%e5%b0%8f%e7%bb%93 aria-label=十、小结>十、小结</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=量化交易入门指南第9天---多因子选股模型factor-investing>量化交易入门指南：第9天 - 多因子选股模型（Factor Investing）<a hidden class=anchor aria-hidden=true href=#量化交易入门指南第9天---多因子选股模型factor-investing>#</a></h1><p><strong>学习时间：60分钟</strong></p><blockquote><p>本文为量化交易学习系列第9天内容，系统讲解多因子选股模型的原理、因子分类、组合方法、实战流程与Python实现，帮助你掌握现代量化基金的Alpha策略核心。</p></blockquote><hr><h2 id=今日目标>今日目标<a hidden class=anchor aria-hidden=true href=#今日目标>#</a></h2><p>你将掌握：</p><ol><li>什么是"因子"（Factor）？</li><li>常见的因子类别和含义</li><li>多因子模型的组合方式</li><li>用 Python 实现一个简单的多因子评分系统</li><li>如何从"因子"走向"策略"？</li></ol><hr><h2 id=一为什么是alpha-策略>一、为什么是"Alpha 策略"？<a hidden class=anchor aria-hidden=true href=#一为什么是alpha-策略>#</a></h2><p>在量化投资中，理解"Alpha"和"Beta"是构建选股策略的基础。</p><ul><li><strong>Alpha（α）</strong>：资产的超额收益，即超出市场基准（如标普500、沪深300）的收益。</li><li><strong>Beta（β）</strong>：资产对市场整体波动的敏感性（系统性风险），如市场涨1%，你的组合涨1.2%，Beta≈1.2。</li><li><strong>Alpha 策略</strong>：通过研究、建模等手段，获取"额外收益"的策略，这种收益不是因为市场整体上涨，而是因为你"选股（择时）能力强"。</li></ul><blockquote><p><strong>目标：</strong> Alpha 策略的目标是击败市场基准，赚取额外收益。</p></blockquote><hr><h2 id=二为什么用因子来构建-alpha-策略>二、为什么用"因子"来构建 Alpha 策略？<a hidden class=anchor aria-hidden=true href=#二为什么用因子来构建-alpha-策略>#</a></h2><p>股票价格的变化并非完全随机，而是受到一系列可量化的驱动因子（Factor）影响：</p><ul><li><strong>价值因子（Value）</strong>：低市盈率、市净率的股票长期表现更好；</li><li><strong>动量因子（Momentum）</strong>：过去表现好的股票短期内更可能继续上涨；</li><li><strong>质量因子（Quality）</strong>：高盈利能力、低负债率的公司长期表现更稳健；</li><li><strong>小市值因子（Size）</strong>：小盘股有时能跑赢大盘股；</li><li><strong>波动率因子（Volatility）</strong>：低波动率的股票长期有超额收益。</li></ul><p>这些"因子"就是预测股票收益的解释变量，是量化选股的基础。</p><blockquote><p><strong>AQR、Two Sigma、桥水等顶级量化机构的核心能力，就是围绕因子构建出组合稳定、风险可控、长期有效的 Alpha 策略。</strong></p></blockquote><hr><h2 id=三alpha-策略-vs-beta-策略>三、Alpha 策略 vs Beta 策略<a hidden class=anchor aria-hidden=true href=#三alpha-策略-vs-beta-策略>#</a></h2><table><thead><tr><th>对比项</th><th>Alpha 策略</th><th>Beta 策略</th></tr></thead><tbody><tr><td>目标</td><td>超越市场收益（择股择时）</td><td>复制市场收益（持有指数）</td></tr><tr><td>收益来源</td><td>股票的相对表现（选得好）</td><td>市场整体上涨（靠大盘）</td></tr><tr><td>代表产品</td><td>多因子选股策略、统计套利</td><td>ETF、指数基金</td></tr><tr><td>难度</td><td>高（需要建模、预测）</td><td>低（只需跟随指数）</td></tr></tbody></table><blockquote><p><strong>小结：</strong> 量化基金用"多个因子"预测股票收益，是为了追求 Alpha（超额收益），而不是简单追踪市场（Beta）。</p></blockquote><hr><h2 id=四什么是因子factor>四、什么是因子（Factor）？<a hidden class=anchor aria-hidden=true href=#四什么是因子factor>#</a></h2><p>在量化中，因子是能够系统性解释资产收益差异的特征变量。</p><p><strong>举例：</strong></p><ul><li>市盈率（PE）低的股票平均表现更好（价值因子）</li><li>最近上涨的股票更容易继续上涨（动量因子）</li></ul><blockquote><p>因子不是噪声，而是"能预测部分收益的结构性信息"。</p></blockquote><hr><h2 id=五常见因子分类五大类>五、常见因子分类（五大类）<a hidden class=anchor aria-hidden=true href=#五常见因子分类五大类>#</a></h2><table><thead><tr><th>因子类型</th><th>示例因子</th><th>含义</th></tr></thead><tbody><tr><td>价值因子</td><td>PE、PB、EV/EBITDA</td><td>低估值股票长期跑赢</td></tr><tr><td>动量因子</td><td>3个月涨幅、6月收益</td><td>趋势延续效应</td></tr><tr><td>质量因子</td><td>ROE、净利润率</td><td>高质量企业表现稳定</td></tr><tr><td>规模因子</td><td>市值、总资产</td><td>小市值公司长期有超额收益</td></tr><tr><td>波动/风险因子</td><td>波动率、Beta、最大回撤</td><td>低波动股票可能更优（Low Vol）</td></tr></tbody></table><hr><h2 id=六单因子-vs-多因子模型>六、单因子 vs 多因子模型<a hidden class=anchor aria-hidden=true href=#六单因子-vs-多因子模型>#</a></h2><ul><li><strong>单因子模型</strong>：只使用一个因子排序选股，简单但容易失效。</li><li><strong>多因子模型</strong>：多个因子融合打分，更稳定、抗噪音。</li></ul><h3 id=多因子融合方法举例>多因子融合方法举例：<a hidden class=anchor aria-hidden=true href=#多因子融合方法举例>#</a></h3><ul><li>Z-score 归一化后加权求和</li><li>PCA 主成分分析</li><li>机器学习模型：XGBoost、线性回归、Random Forest 等</li></ul><hr><h3 id=1-z-score-加权求和法标准化加权法>1. Z-score 加权求和法（标准化加权法）<a hidden class=anchor aria-hidden=true href=#1-z-score-加权求和法标准化加权法>#</a></h3><p><strong>原理：</strong></p><ul><li>各因子的量纲、尺度不同（如 PE 是几十，动量是百分比），需归一化处理；</li><li>Z-score 是最常见的标准化方式：</li></ul><p>$$
Z_i = \frac{x_i - \mu}{\sigma}
$$</p><p>其中 $x_i$ 是某只股票在该因子的原始值，$\mu$ 和 $\sigma$ 是该因子的均值和标准差。</p><ul><li>多个标准化后的因子 $Z_1, Z_2, …, Z_n$ 再根据权重 $w_1, w_2, …, w_n$ 加权求和：</li></ul><p>$$
\text{Score}i = \sum{j=1}^{n} w_j \cdot Z_{ij}
$$</p><p><strong>应用步骤：</strong></p><ol><li>选取多个有效因子（如动量、价值、波动率、质量等）；</li><li>对每个因子做 Z-score 处理（在横截面标准化）；</li><li>为每个因子设置权重（可手动设定或用历史绩效决定）；</li><li>对每只股票打分（加权求和）并排序，构建组合。</li></ol><p><strong>优点：</strong></p><ol><li>简单直观，便于解释；</li><li>不需要复杂算法，容易实施；</li><li>控制权重可以加入"主观判断"。</li></ol><p><strong>缺点：</strong></p><ol><li>因子权重是静态或拍脑袋设的；</li><li>无法自动适应市场风格变化；</li><li>因子间的冗余、相关性未处理。</li></ol><hr><h3 id=2-pca-主成分分析降维融合法>2. PCA 主成分分析（降维融合法）<a hidden class=anchor aria-hidden=true href=#2-pca-主成分分析降维融合法>#</a></h3><p><strong>原理：</strong></p><ul><li>PCA 是一种无监督降维算法，用于从多个相关变量中提取最核心的无关成分，即"主成分"。</li><li>在多因子选股中，PCA 用于提取综合打分的主方向，减少冗余信息。</li></ul><p><strong>操作流程：</strong></p><ol><li>对每个因子进行 Z-score 标准化；</li><li>构造因子矩阵 X：每行是股票，每列是因子；</li><li>对 X 做协方差矩阵计算，求解特征值和特征向量；</li><li>保留前几个主成分（解释了大部分信息），得到：</li></ol><p>$$
\text{PC}_1 = \sum_j w_j \cdot Z_j
$$</p><p>第一个主成分通常作为"综合因子分数"；
5. 用 PC1 排序选股。</p><p><strong>优点：</strong></p><ol><li>自动识别最重要的信息方向；</li><li>可剔除冗余或高相关因子；</li><li>非人为设定权重，数据驱动。</li></ol><p><strong>缺点：</strong></p><ol><li>主成分权重不可解释（变成了组合线性项）；</li><li>主成分不一定有经济含义；</li><li>假设数据服从线性结构，非线性无效。</li></ol><hr><h3 id=3-机器学习模型融合非线性方法>3. 机器学习模型融合（非线性方法）<a hidden class=anchor aria-hidden=true href=#3-机器学习模型融合非线性方法>#</a></h3><p><strong>原理：</strong></p><ul><li>使用机器学习模型（如 XGBoost、Random Forest、线性回归等）来学习因子与"未来收益"之间的映射关系。</li><li>因子作为特征，未来收益为标签，训练模型得到预测器。</li></ul><p><strong>应用流程：</strong></p><ol><li>构建训练集：<ul><li>特征：多因子横截面数据（如动量、估值、盈利质量等）；</li><li>标签：未来 n 天/1 个月收益率；</li></ul></li><li>选模型（XGBoost、随机森林、逻辑回归、SVM等）；</li><li>训练模型并交叉验证；</li><li>在预测期使用模型输出股票"预期收益" → 排序建仓；</li><li>定期更新模型或重新训练。</li></ol><p><strong>优点：</strong> 可自动学习非线性、交互项；可以挖掘隐藏结构（如哪个因子在当前市场更有效）；灵活且可与大数据结合。</p><p><strong>缺点：</strong> 黑箱模型，不易解释；容易过拟合（尤其样本小/特征多）；需要更强算力、数据、调参经验。</p><hr><h3 id=总结比较>总结比较<a hidden class=anchor aria-hidden=true href=#总结比较>#</a></h3><table><thead><tr><th>方法</th><th>原理</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td>Z-score加权</td><td>标准化 + 权重加总</td><td>简单易用、可控</td><td>无法自适应、冗余多</td><td>初学者、快速测试</td></tr><tr><td>PCA降维</td><td>降维提主成分</td><td>自动识别核心成分</td><td>不可解释、假设线性</td><td>有多个高相关因子时</td></tr><tr><td>机器学习</td><td>学习因子→收益映射</td><td>可建复杂非线性模型</td><td>黑箱+易过拟合</td><td>大数据、实盘策略</td></tr></tbody></table><hr><h2 id=七因子挖掘流程实战视角>七、因子挖掘流程（实战视角）<a hidden class=anchor aria-hidden=true href=#七因子挖掘流程实战视角>#</a></h2><h3 id=1-构建因子库>1️⃣ 构建因子库<a hidden class=anchor aria-hidden=true href=#1-构建因子库>#</a></h3><ul><li>目的：从多个维度（财务/市场/行为）系统收集可能有效的特征变量，为后续筛选打基础。</li><li>数据来源：Tushare Pro、Wind、聚宽、RiceQuant</li><li>数据频率：财务因子用季度数据，行情因子用日频或周频</li><li>因子类型：<ul><li>财务类：PE、PB、ROE、营收增长等</li><li>行情类：动量（近3月涨幅）、波动率、换手率等</li><li>行为类：新闻情绪、基金调仓轨迹、龙虎榜等</li></ul></li></ul><h3 id=2-标准化处理>2️⃣ 标准化处理<a hidden class=anchor aria-hidden=true href=#2-标准化处理>#</a></h3><ul><li>目的：将不同量纲的因子统一为可比较的标准格式，并处理异常值，消除极端影响。</li><li>常见方法：<ul><li>Z-score：$z = \frac{x - \mu}{\sigma}$，转为标准正态分布</li><li>Min-Max：将值压缩到[0, 1]区间</li><li>去极值（winsorize）：截断极端值（如1%、99%）</li><li>行业/市值中性化：消除行业结构或市值对因子的影响</li></ul></li></ul><h3 id=3-单因子测试>3️⃣ 单因子测试<a hidden class=anchor aria-hidden=true href=#3-单因子测试>#</a></h3><ul><li>目的：判断某个单因子是否具备预测未来收益的能力（alpha 信息含量）。</li><li>常用检验方法：<ul><li>分组收益法：将股票按因子打分分组，比较高组 vs 低组未来收益</li><li>IC（信息系数）：因子值与未来收益的 Spearman 相关系数</li><li>IR（信息比率）：$IR = \frac{\text{年化因子组合超额收益}}{\text{年化波动}}$</li><li>T检验：高分组收益是否显著大于低分组</li></ul></li><li>判断标准：<ul><li>IC > 0.02 一般认为有效，> 0.05 较强</li><li>分组图呈现"单调结构"最佳（高分组 > 中 > 低）</li></ul></li></ul><h3 id=4-因子组合评分>4️⃣ 因子组合评分<a hidden class=anchor aria-hidden=true href=#4-因子组合评分>#</a></h3><ul><li>目的：融合多个有效因子，提高策略稳定性，减少"因子漂移"与"失效风险"。</li><li>融合方法：<ul><li>Z-score加权、PCA、机器学习模型、IC加权组合</li></ul></li><li>输出结果：每只股票得到一个"多因子评分"，用于排序选股。</li></ul><h3 id=5-选股--回测--组合优化>5️⃣ 选股 + 回测 + 组合优化<a hidden class=anchor aria-hidden=true href=#5-选股--回测--组合优化>#</a></h3><ul><li>目的：用因子评分排序，选出前 N 名股票构建组合，并通过回测评估其历史表现。</li><li>选股逻辑：每期取评分排名前 5%、10%、20% 的股票，可设定行业、市值中性化约束</li><li>回测核心指标：年化收益率、夏普比率、最大回撤、胜率、换手率</li><li>组合优化：等权、风险平价、最小方差、均值-方差优化</li></ul><h3 id=6-部署策略-or-实盘监控>6️⃣ 部署策略 or 实盘监控<a hidden class=anchor aria-hidden=true href=#6-部署策略-or-实盘监控>#</a></h3><ul><li>目的：将策略落地运行在实际环境中，观察表现、调优及风控。</li><li>工具推荐：Tushare Pro、RiceQuant、聚宽、backtrader、Qlib、Pyfolio、EasyTrader、vn.py</li><li>常见实盘问题：板块轮动、高换手、滞后问题</li></ul><blockquote><p><strong>小结：</strong> 因子挖掘的流程是一个从信息提取 → 信号验证 → 策略集成 → 交易落地的完整闭环，每一步都强调数据严谨性、统计显著性与执行可行性。</p></blockquote><hr><h2 id=八python-实战多因子评分系统>八、Python 实战：多因子评分系统<a hidden class=anchor aria-hidden=true href=#八python-实战多因子评分系统>#</a></h2><p>我们实现一个简化版的多因子评分系统，用于选出"优质股票"。</p><p><strong>步骤：使用财务数据构建三因子打分系统（价值 + 质量 + 动量）</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.preprocessing <span style=color:#f92672>import</span> StandardScaler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 假设有一个DataFrame，每一行是股票，每一列是因子</span>
</span></span><span style=display:flex><span>data <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;stock&#39;</span>: [<span style=color:#e6db74>&#39;A&#39;</span>, <span style=color:#e6db74>&#39;B&#39;</span>, <span style=color:#e6db74>&#39;C&#39;</span>, <span style=color:#e6db74>&#39;D&#39;</span>],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;pe&#39;</span>: [<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>25</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>8</span>],        <span style=color:#75715e># 价值因子（越低越好）</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;roe&#39;</span>: [<span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>8</span>, <span style=color:#ae81ff>20</span>],       <span style=color:#75715e># 质量因子（越高越好）</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;momentum&#39;</span>: [<span style=color:#ae81ff>0.1</span>, <span style=color:#ae81ff>0.05</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>0.02</span>, <span style=color:#ae81ff>0.15</span>]  <span style=color:#75715e># 动量因子（越高越好）</span>
</span></span><span style=display:flex><span>})
</span></span><span style=display:flex><span>data<span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#39;stock&#39;</span>, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 标准化处理</span>
</span></span><span style=display:flex><span>scaler <span style=color:#f92672>=</span> StandardScaler()
</span></span><span style=display:flex><span>factors <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;pe&#39;</span>, <span style=color:#e6db74>&#39;roe&#39;</span>, <span style=color:#e6db74>&#39;momentum&#39;</span>]
</span></span><span style=display:flex><span>data_std <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(scaler<span style=color:#f92672>.</span>fit_transform(data[factors]), 
</span></span><span style=display:flex><span>                        columns<span style=color:#f92672>=</span>factors, 
</span></span><span style=display:flex><span>                        index<span style=color:#f92672>=</span>data<span style=color:#f92672>.</span>index)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 注意：pe 低才好，要取负值</span>
</span></span><span style=display:flex><span>data_std[<span style=color:#e6db74>&#39;pe&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#f92672>-</span>data_std[<span style=color:#e6db74>&#39;pe&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 简单平均打分</span>
</span></span><span style=display:flex><span>data_std[<span style=color:#e6db74>&#39;score&#39;</span>] <span style=color:#f92672>=</span> data_std<span style=color:#f92672>.</span>mean(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 排序选股</span>
</span></span><span style=display:flex><span>print(data_std<span style=color:#f92672>.</span>sort_values(<span style=color:#e6db74>&#39;score&#39;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>))
</span></span></code></pre></div><p><strong>分析：哪只股票综合表现最好？如果选 Top 2，会是哪两只？</strong></p><hr><h2 id=九思考题理解因子选股核心>九、思考题（理解因子选股核心）<a hidden class=anchor aria-hidden=true href=#九思考题理解因子选股核心>#</a></h2><h3 id=1-为什么单因子策略容易失效>1️⃣ 为什么单因子策略容易"失效"？<a hidden class=anchor aria-hidden=true href=#1-为什么单因子策略容易失效>#</a></h3><table><thead><tr><th>原因类型</th><th>具体解释</th></tr></thead><tbody><tr><td>拥挤交易</td><td>市场大量资金使用同一因子，超额收益被套利抹平</td></tr><tr><td>因子周期性</td><td>因子效果存在周期，某些阶段有效，某些阶段失效</td></tr><tr><td>结构变化</td><td>宏观政策、估值体系或行业逻辑改变导致因子失效</td></tr><tr><td>缺乏稳健性</td><td>单因子抗干扰能力差，易受极端数据或短期波动影响</td></tr></tbody></table><blockquote><p>比如：动量因子在牛市中表现亮眼，但熊市中反转频繁，效果可能变差。</p></blockquote><h3 id=2-如何判断一个因子是否有效>2️⃣ 如何判断一个因子是否"有效"？<a hidden class=anchor aria-hidden=true href=#2-如何判断一个因子是否有效>#</a></h3><table><thead><tr><th>检验维度</th><th>检验方法</th></tr></thead><tbody><tr><td>信息比率（IR）</td><td>IR = 年化超额收益 / 年化跟踪误差，越高越好</td></tr><tr><td>IC（信息系数）</td><td>因子与未来收益的 Spearman/Pearson 相关系数，IC > 0.02 通常有效</td></tr><tr><td>分层回测</td><td>因子分组，检验高分组是否优于低分组</td></tr><tr><td>横截面回归</td><td>因子解释横截面收益，t值 > 2 更好</td></tr><tr><td>稳定性与可迁移性</td><td>不同时间、行业、市场是否仍有效</td></tr></tbody></table><h3 id=3-如果两个因子高度相关组合时会出现什么问题>3️⃣ 如果两个因子高度相关，组合时会出现什么问题？<a hidden class=anchor aria-hidden=true href=#3-如果两个因子高度相关组合时会出现什么问题>#</a></h3><table><thead><tr><th>问题类型</th><th>说明</th></tr></thead><tbody><tr><td>冗余信息</td><td>反复加入相似信息不会提升预测效果，只会放大权重偏差</td></tr><tr><td>权重不稳</td><td>回归模型中权重会变得不稳定、容易过拟合</td></tr><tr><td>噪声放大</td><td>相关因子的误差可能会相互强化而非抵消</td></tr></tbody></table><ul><li>示例：若用"PB"和"PE"作为两个因子，这两者都高度相关于"估值"，组合后并不会真正多样化。</li><li>解决方案：相关性检测、降维（PCA）、删除冗余因子</li></ul><h3 id=4-动量因子是否会在极端行情中失效>4️⃣ 动量因子是否会在极端行情中失效？<a hidden class=anchor aria-hidden=true href=#4-动量因子是否会在极端行情中失效>#</a></h3><p>是的，动量因子典型地在极端行情中"反转失效"。</p><table><thead><tr><th>市场阶段</th><th>动量表现</th></tr></thead><tbody><tr><td>趋势强烈（牛市）</td><td>非常有效，顺势上涨</td></tr><tr><td>震荡市/横盘市</td><td>失效，涨跌反复，信号混乱</td></tr><tr><td>极端转折点</td><td>严重失效，强势股被快速抛售</td></tr></tbody></table><ul><li>举例：<ul><li>2020年3月疫情冲击，之前涨得猛的股票（如科技股）出现剧烈回调，动量策略遭遇大幅回撤。</li><li>2008金融危机也是动量策略失效的典型案例。</li></ul></li><li>应对方式：加入风险控制、设置切换机制、动量+反转/低波动等多因子组合增强稳定性</li></ul><hr><h2 id=十小结>十、小结<a hidden class=anchor aria-hidden=true href=#十小结>#</a></h2><table><thead><tr><th>内容</th><th>你应掌握的知识</th></tr></thead><tbody><tr><td>因子是什么</td><td>能解释收益差异的特征变量</td></tr><tr><td>因子分类</td><td>价值、质量、动量、波动、规模</td></tr><tr><td>多因子组合</td><td>标准化 → 加权 → 打分 → 选股</td></tr><tr><td>Python 实战</td><td>简单实现 Z-score 多因子评分</td></tr></tbody></table><hr><p>通过今天的学习，你已经掌握了多因子选股模型的核心原理、实战流程与Python实现。下一讲我们将进入"量化回测与风险管理"的世界，敬请期待！</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://xuyafei.github.io/personal-site/tags/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/>量化交易</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/%E5%A4%9A%E5%9B%A0%E5%AD%90/>多因子</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/%E9%80%89%E8%82%A1%E6%A8%A1%E5%9E%8B/>选股模型</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/alpha/>Alpha</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/%E5%9B%A0%E5%AD%90%E6%8A%95%E8%B5%84/>因子投资</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/python%E5%AE%9E%E6%88%98/>Python实战</a></li></ul><nav class=paginav><a class=prev href=https://xuyafei.github.io/personal-site/posts/rtp_rtcp_protocol/><span class=title>« Prev</span><br><span>RTP/RTCP协议详解</span>
</a><a class=next href=https://xuyafei.github.io/personal-site/posts/network_jitter_buffer/><span class=title>Next »</span><br><span>网络抖动与Jitter Buffer详解</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on x" href="https://x.com/intent/tweet/?text=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89&amp;url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f&amp;hashtags=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%2c%e5%a4%9a%e5%9b%a0%e5%ad%90%2c%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%2cAlpha%2c%e5%9b%a0%e5%ad%90%e6%8a%95%e8%b5%84%2cPython%e5%ae%9e%e6%88%98"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f&amp;title=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89&amp;summary=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89&amp;source=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f&title=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on whatsapp" href="https://api.whatsapp.com/send?text=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89%20-%20https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on telegram" href="https://telegram.me/share/url?text=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89&amp;url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 量化交易入门指南：第9天 - 多因子选股模型（Factor Investing） on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e9%87%8f%e5%8c%96%e4%ba%a4%e6%98%93%e5%85%a5%e9%97%a8%e6%8c%87%e5%8d%97%ef%bc%9a%e7%ac%ac9%e5%a4%a9%20-%20%e5%a4%9a%e5%9b%a0%e5%ad%90%e9%80%89%e8%82%a1%e6%a8%a1%e5%9e%8b%ef%bc%88Factor%20Investing%ef%bc%89&u=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fquantitative_trading_day9%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xuyafei.github.io/personal-site/>我的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>
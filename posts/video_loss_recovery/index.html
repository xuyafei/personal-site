<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>视频传输中的丢包恢复机制：NACK与FEC详解 | 我的博客</title>
<meta name=keywords content="视频传输,实时通信,网络传输,NACK,FEC,WebRTC"><meta name=description content="深入解析视频传输中的两种关键丢包恢复策略：NACK（负确认）和FEC（前向纠错）的原理、实现和应用场景"><meta name=author content="徐亚飞"><link rel=canonical href=https://xuyafei.github.io/personal-site/posts/video_loss_recovery/><link crossorigin=anonymous href=/personal-site/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://xuyafei.github.io/personal-site/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://xuyafei.github.io/personal-site/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://xuyafei.github.io/personal-site/favicon-32x32.png><link rel=apple-touch-icon href=https://xuyafei.github.io/personal-site/apple-touch-icon.png><link rel=mask-icon href=https://xuyafei.github.io/personal-site/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://xuyafei.github.io/personal-site/posts/video_loss_recovery/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAYQHy+K8nqKdr1EzvFzSQC+TAXx6gNQgoRxKtj+P9vvCCQTRWiV crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\[",right:"\\]",display:!0},{left:"\\(",right:"\\)",display:!1}],throwOnError:!1})})</script><script>MathJax={tex:{inlineMath:[["$","$"]],displayMath:[["$$","$$"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><meta property="og:url" content="https://xuyafei.github.io/personal-site/posts/video_loss_recovery/"><meta property="og:site_name" content="我的博客"><meta property="og:title" content="视频传输中的丢包恢复机制：NACK与FEC详解"><meta property="og:description" content="深入解析视频传输中的两种关键丢包恢复策略：NACK（负确认）和FEC（前向纠错）的原理、实现和应用场景"><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-22T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-22T00:00:00+00:00"><meta property="article:tag" content="视频传输"><meta property="article:tag" content="实时通信"><meta property="article:tag" content="网络传输"><meta property="article:tag" content="NACK"><meta property="article:tag" content="FEC"><meta property="article:tag" content="WebRTC"><meta name=twitter:card content="summary"><meta name=twitter:title content="视频传输中的丢包恢复机制：NACK与FEC详解"><meta name=twitter:description content="深入解析视频传输中的两种关键丢包恢复策略：NACK（负确认）和FEC（前向纠错）的原理、实现和应用场景"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://xuyafei.github.io/personal-site/posts/"},{"@type":"ListItem","position":2,"name":"视频传输中的丢包恢复机制：NACK与FEC详解","item":"https://xuyafei.github.io/personal-site/posts/video_loss_recovery/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"视频传输中的丢包恢复机制：NACK与FEC详解","name":"视频传输中的丢包恢复机制：NACK与FEC详解","description":"深入解析视频传输中的两种关键丢包恢复策略：NACK（负确认）和FEC（前向纠错）的原理、实现和应用场景","keywords":["视频传输","实时通信","网络传输","NACK","FEC","WebRTC"],"articleBody":"视频传输中的丢包恢复机制：NACK与FEC详解 一、概述 在实时视频传输中，网络丢包是影响视频质量的主要因素之一。为了提供流畅的视频体验，业界开发了多种丢包恢复机制，其中NACK（Negative Acknowledgement）和FEC（Forward Error Correction）是最重要的两种技术。本文将深入解析这两种技术的原理、实现和应用场景。\n二、NACK（Negative Acknowledgement） 1. 定义与原理 NACK是一种基于反馈的重传机制，接收端通过发送否定确认来请求发送端重传丢失的数据包。\n2. 工作流程 发送端通过RTP发送媒体包（视频RTP包） 接收端RTP解包时检测缺失序号 例如：收到序号100、101、103，说明102丢失 接收端构建RTCP NACK消息，发送回发送端 发送端根据缓存重新发送丢失的RTP包 3. 应用条件与限制 项目 描述 ✅ 适合场景 偶发性、低延迟网络中的小范围丢包 ❌ 不适合场景 丢包严重、时延较高（≥250ms） 限制条件 发送端必须有RTP重传缓存（200~500ms） 延迟影响 至少一倍RTT（往返时延）才能恢复该帧 4. 优缺点分析 优点 缺点 节省带宽（只在丢包时重传） 恢复存在RTT延迟 精准修复 高丢包下效率低 简单易实现 要求发送端有缓存 5. 实际应用 WebRTC支持基于RTCP NACK的重传机制 主要用于关键帧或参考帧的恢复 通常与RTP Retransmission (RTX)配合使用 使用新的SSRC和负载类型 三、视频FEC（Forward Error Correction） 1. 定义与原理 FEC是一种前向纠错机制，发送端在发送时附加冗余信息，使得接收端可以自行恢复丢失的数据，无需重传。\n2. 常见类型 ULPFEC（RFC 5109）\n用于RTP层的传统视频FEC 支持冗余帧压缩 FlexFEC（WebRTC推荐）\n支持任意帧布局 灵活性强，效率更高 Reed-Solomon / XOR\n数据级编码方式 适用于block-based分组 3. 工作机制 以XOR为例：\n原始包：P1 P2 P3 P4 FEC包：FEC = P1 ⊕ P2 ⊕ P3 ⊕ P4 如果P3丢失，可以通过： P3 = FEC ⊕ P1 ⊕ P2 ⊕ P4 恢复数据 4. 应用场景 项目 描述 适合场景 丢包较多、RTT高，无法容忍NACK重传 不适合场景 带宽非常受限、丢包稀少的网络 特别适用 视频关键帧保护（I帧/FU-A） 5. 优缺点分析 优点 缺点 无需重传，低延迟恢复 增加带宽（冗余负载） 能处理突发丢包 冗余设计要谨慎，过多会浪费资源 与NACK可协同使用 编码/解码复杂度略高 四、NACK与FEC的协同使用 1. 策略选择指南 网络状态 推荐机制 轻微丢包（\u003c5%） NACK 中等丢包（5-15%） NACK + FEC 高丢包/高延迟 FEC优先，降低NACK比例 2. 对比总结 特性 NACK FEC 是否需要反馈 是（RTCP） 否 是否需要重传 是 否（冗余解码） 恢复延迟 高（取决于RTT） 低（几乎实时） 带宽开销 小（视丢包情况而定） 高（需增加冗余） 恢复能力 高（理论上100%恢复） 有限（最多1-2个包的丢失恢复） 实际用途 恢复重要参考帧（I帧） 恢复突发数据包、关键帧保护等 五、实现细节 1. RTP + FEC模块结构 【视频编码器】 → 【RTP打包】 ─────┐ │ ┌───────▼────────┐ │ FEC生成器（如FlexFEC）│ └───────┬────────┘ │ 原始RTP包 ────────────────────┼─→ 发送到网络 冗余FEC包 ────────────────────┘ ↙ 【网络】 ↘ 【接收端RTP Demux】 ↓ ↘ 原始RTP包 FEC RTP包 ↓ ↓ 【重传检测/NACK】 【FEC解码器】 ↓ ↓ →→→→→→→→→→→→→→→→ │ │ ↓ ↓ 【解码器 ← 重建帧 ← FEC还原】 2. 实现注意事项 FEC属于RTP层，不影响H.264编码器 需要发送端和接收端都支持 通过SDP协商和C++配置启用 适合视频通话等实时场景 六、总结 NACK和FEC是视频传输中两种互补的丢包恢复机制 NACK适合低丢包、低延迟场景 FEC适合高丢包、高延迟场景 实际应用中常组合使用，根据网络状况动态调整 选择策略时需权衡带宽、延迟和恢复能力 参考文献：\n“WebRTC: APIs and RTCWEB Protocols of the HTML5 Real-Time Web” by Alan B. Johnston “Real-Time Communication with WebRTC” by Salvatore Loreto “RTP: Audio and Video for the Internet” by Colin Perkins “Video Coding for Mobile Communications” by Mohammed Ghanbari “Digital Video Processing” by A. Murat Tekalp “Video Compression and Communications” by Lajos Hanzo “Network Performance Analysis” by Thomas Bonald “Multimedia Communications” by Fred Halsall “Streaming Media” by Geoff Huston “Internetworking with TCP/IP” by Douglas E. Comer ","wordCount":"290","inLanguage":"en","datePublished":"2024-04-22T00:00:00Z","dateModified":"2024-04-22T00:00:00Z","author":{"@type":"Person","name":"徐亚飞"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://xuyafei.github.io/personal-site/posts/video_loss_recovery/"},"publisher":{"@type":"Organization","name":"我的博客","logo":{"@type":"ImageObject","url":"https://xuyafei.github.io/personal-site/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://xuyafei.github.io/personal-site/ accesskey=h title="我的博客 (Alt + H)">我的博客</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://xuyafei.github.io/personal-site/categories/ title=分类><span>分类</span></a></li><li><a href=https://xuyafei.github.io/personal-site/tags/ title=标签><span>标签</span></a></li><li><a href=https://xuyafei.github.io/personal-site/archives/ title=归档><span>归档</span></a></li><li><a href=https://xuyafei.github.io/personal-site/search/ title=搜索><span>搜索</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://xuyafei.github.io/personal-site/>Home</a>&nbsp;»&nbsp;<a href=https://xuyafei.github.io/personal-site/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">视频传输中的丢包恢复机制：NACK与FEC详解</h1><div class=post-description>深入解析视频传输中的两种关键丢包恢复策略：NACK（负确认）和FEC（前向纠错）的原理、实现和应用场景</div><div class=post-meta><span title='2024-04-22 00:00:00 +0000 UTC'>April 22, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;徐亚飞</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6nack%e4%b8%8efec%e8%af%a6%e8%a7%a3 aria-label=视频传输中的丢包恢复机制：NACK与FEC详解>视频传输中的丢包恢复机制：NACK与FEC详解</a><ul><li><a href=#%e4%b8%80%e6%a6%82%e8%bf%b0 aria-label=一、概述>一、概述</a></li><li><a href=#%e4%ba%8cnacknegative-acknowledgement aria-label="二、NACK（Negative Acknowledgement）">二、NACK（Negative Acknowledgement）</a><ul><li><a href=#1-%e5%ae%9a%e4%b9%89%e4%b8%8e%e5%8e%9f%e7%90%86 aria-label="1. 定义与原理">1. 定义与原理</a></li><li><a href=#2-%e5%b7%a5%e4%bd%9c%e6%b5%81%e7%a8%8b aria-label="2. 工作流程">2. 工作流程</a></li><li><a href=#3-%e5%ba%94%e7%94%a8%e6%9d%a1%e4%bb%b6%e4%b8%8e%e9%99%90%e5%88%b6 aria-label="3. 应用条件与限制">3. 应用条件与限制</a></li><li><a href=#4-%e4%bc%98%e7%bc%ba%e7%82%b9%e5%88%86%e6%9e%90 aria-label="4. 优缺点分析">4. 优缺点分析</a></li><li><a href=#5-%e5%ae%9e%e9%99%85%e5%ba%94%e7%94%a8 aria-label="5. 实际应用">5. 实际应用</a></li></ul></li><li><a href=#%e4%b8%89%e8%a7%86%e9%a2%91fecforward-error-correction aria-label="三、视频FEC（Forward Error Correction）">三、视频FEC（Forward Error Correction）</a><ul><li><a href=#1-%e5%ae%9a%e4%b9%89%e4%b8%8e%e5%8e%9f%e7%90%86-1 aria-label="1. 定义与原理">1. 定义与原理</a></li><li><a href=#2-%e5%b8%b8%e8%a7%81%e7%b1%bb%e5%9e%8b aria-label="2. 常见类型">2. 常见类型</a></li><li><a href=#3-%e5%b7%a5%e4%bd%9c%e6%9c%ba%e5%88%b6 aria-label="3. 工作机制">3. 工作机制</a></li><li><a href=#4-%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af aria-label="4. 应用场景">4. 应用场景</a></li><li><a href=#5-%e4%bc%98%e7%bc%ba%e7%82%b9%e5%88%86%e6%9e%90 aria-label="5. 优缺点分析">5. 优缺点分析</a></li></ul></li><li><a href=#%e5%9b%9bnack%e4%b8%8efec%e7%9a%84%e5%8d%8f%e5%90%8c%e4%bd%bf%e7%94%a8 aria-label=四、NACK与FEC的协同使用>四、NACK与FEC的协同使用</a><ul><li><a href=#1-%e7%ad%96%e7%95%a5%e9%80%89%e6%8b%a9%e6%8c%87%e5%8d%97 aria-label="1. 策略选择指南">1. 策略选择指南</a></li><li><a href=#2-%e5%af%b9%e6%af%94%e6%80%bb%e7%bb%93 aria-label="2. 对比总结">2. 对比总结</a></li></ul></li><li><a href=#%e4%ba%94%e5%ae%9e%e7%8e%b0%e7%bb%86%e8%8a%82 aria-label=五、实现细节>五、实现细节</a><ul><li><a href=#1-rtp--fec%e6%a8%a1%e5%9d%97%e7%bb%93%e6%9e%84 aria-label="1. RTP + FEC模块结构">1. RTP + FEC模块结构</a></li><li><a href=#2-%e5%ae%9e%e7%8e%b0%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9 aria-label="2. 实现注意事项">2. 实现注意事项</a></li></ul></li><li><a href=#%e5%85%ad%e6%80%bb%e7%bb%93 aria-label=六、总结>六、总结</a></li></ul></li></ul></div></details></div><div class=post-content><h1 id=视频传输中的丢包恢复机制nack与fec详解>视频传输中的丢包恢复机制：NACK与FEC详解<a hidden class=anchor aria-hidden=true href=#视频传输中的丢包恢复机制nack与fec详解>#</a></h1><h2 id=一概述>一、概述<a hidden class=anchor aria-hidden=true href=#一概述>#</a></h2><p>在实时视频传输中，网络丢包是影响视频质量的主要因素之一。为了提供流畅的视频体验，业界开发了多种丢包恢复机制，其中NACK（Negative Acknowledgement）和FEC（Forward Error Correction）是最重要的两种技术。本文将深入解析这两种技术的原理、实现和应用场景。</p><h2 id=二nacknegative-acknowledgement>二、NACK（Negative Acknowledgement）<a hidden class=anchor aria-hidden=true href=#二nacknegative-acknowledgement>#</a></h2><h3 id=1-定义与原理>1. 定义与原理<a hidden class=anchor aria-hidden=true href=#1-定义与原理>#</a></h3><p>NACK是一种基于反馈的重传机制，接收端通过发送否定确认来请求发送端重传丢失的数据包。</p><h3 id=2-工作流程>2. 工作流程<a hidden class=anchor aria-hidden=true href=#2-工作流程>#</a></h3><ol><li>发送端通过RTP发送媒体包（视频RTP包）</li><li>接收端RTP解包时检测缺失序号<ul><li>例如：收到序号100、101、103，说明102丢失</li></ul></li><li>接收端构建RTCP NACK消息，发送回发送端</li><li>发送端根据缓存重新发送丢失的RTP包</li></ol><h3 id=3-应用条件与限制>3. 应用条件与限制<a hidden class=anchor aria-hidden=true href=#3-应用条件与限制>#</a></h3><table><thead><tr><th>项目</th><th>描述</th></tr></thead><tbody><tr><td>✅ 适合场景</td><td>偶发性、低延迟网络中的小范围丢包</td></tr><tr><td>❌ 不适合场景</td><td>丢包严重、时延较高（≥250ms）</td></tr><tr><td>限制条件</td><td>发送端必须有RTP重传缓存（200~500ms）</td></tr><tr><td>延迟影响</td><td>至少一倍RTT（往返时延）才能恢复该帧</td></tr></tbody></table><h3 id=4-优缺点分析>4. 优缺点分析<a hidden class=anchor aria-hidden=true href=#4-优缺点分析>#</a></h3><table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>节省带宽（只在丢包时重传）</td><td>恢复存在RTT延迟</td></tr><tr><td>精准修复</td><td>高丢包下效率低</td></tr><tr><td>简单易实现</td><td>要求发送端有缓存</td></tr></tbody></table><h3 id=5-实际应用>5. 实际应用<a hidden class=anchor aria-hidden=true href=#5-实际应用>#</a></h3><ul><li>WebRTC支持基于RTCP NACK的重传机制</li><li>主要用于关键帧或参考帧的恢复</li><li>通常与RTP Retransmission (RTX)配合使用</li><li>使用新的SSRC和负载类型</li></ul><h2 id=三视频fecforward-error-correction>三、视频FEC（Forward Error Correction）<a hidden class=anchor aria-hidden=true href=#三视频fecforward-error-correction>#</a></h2><h3 id=1-定义与原理-1>1. 定义与原理<a hidden class=anchor aria-hidden=true href=#1-定义与原理-1>#</a></h3><p>FEC是一种前向纠错机制，发送端在发送时附加冗余信息，使得接收端可以自行恢复丢失的数据，无需重传。</p><h3 id=2-常见类型>2. 常见类型<a hidden class=anchor aria-hidden=true href=#2-常见类型>#</a></h3><ol><li><p>ULPFEC（RFC 5109）</p><ul><li>用于RTP层的传统视频FEC</li><li>支持冗余帧压缩</li></ul></li><li><p>FlexFEC（WebRTC推荐）</p><ul><li>支持任意帧布局</li><li>灵活性强，效率更高</li></ul></li><li><p>Reed-Solomon / XOR</p><ul><li>数据级编码方式</li><li>适用于block-based分组</li></ul></li></ol><h3 id=3-工作机制>3. 工作机制<a hidden class=anchor aria-hidden=true href=#3-工作机制>#</a></h3><p>以XOR为例：</p><pre tabindex=0><code>原始包：P1  P2  P3  P4
FEC包：FEC = P1 ⊕ P2 ⊕ P3 ⊕ P4

如果P3丢失，可以通过：
P3 = FEC ⊕ P1 ⊕ P2 ⊕ P4
恢复数据
</code></pre><h3 id=4-应用场景>4. 应用场景<a hidden class=anchor aria-hidden=true href=#4-应用场景>#</a></h3><table><thead><tr><th>项目</th><th>描述</th></tr></thead><tbody><tr><td>适合场景</td><td>丢包较多、RTT高，无法容忍NACK重传</td></tr><tr><td>不适合场景</td><td>带宽非常受限、丢包稀少的网络</td></tr><tr><td>特别适用</td><td>视频关键帧保护（I帧/FU-A）</td></tr></tbody></table><h3 id=5-优缺点分析>5. 优缺点分析<a hidden class=anchor aria-hidden=true href=#5-优缺点分析>#</a></h3><table><thead><tr><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>无需重传，低延迟恢复</td><td>增加带宽（冗余负载）</td></tr><tr><td>能处理突发丢包</td><td>冗余设计要谨慎，过多会浪费资源</td></tr><tr><td>与NACK可协同使用</td><td>编码/解码复杂度略高</td></tr></tbody></table><h2 id=四nack与fec的协同使用>四、NACK与FEC的协同使用<a hidden class=anchor aria-hidden=true href=#四nack与fec的协同使用>#</a></h2><h3 id=1-策略选择指南>1. 策略选择指南<a hidden class=anchor aria-hidden=true href=#1-策略选择指南>#</a></h3><table><thead><tr><th>网络状态</th><th>推荐机制</th></tr></thead><tbody><tr><td>轻微丢包（&lt;5%）</td><td>NACK</td></tr><tr><td>中等丢包（5-15%）</td><td>NACK + FEC</td></tr><tr><td>高丢包/高延迟</td><td>FEC优先，降低NACK比例</td></tr></tbody></table><h3 id=2-对比总结>2. 对比总结<a hidden class=anchor aria-hidden=true href=#2-对比总结>#</a></h3><table><thead><tr><th>特性</th><th>NACK</th><th>FEC</th></tr></thead><tbody><tr><td>是否需要反馈</td><td>是（RTCP）</td><td>否</td></tr><tr><td>是否需要重传</td><td>是</td><td>否（冗余解码）</td></tr><tr><td>恢复延迟</td><td>高（取决于RTT）</td><td>低（几乎实时）</td></tr><tr><td>带宽开销</td><td>小（视丢包情况而定）</td><td>高（需增加冗余）</td></tr><tr><td>恢复能力</td><td>高（理论上100%恢复）</td><td>有限（最多1-2个包的丢失恢复）</td></tr><tr><td>实际用途</td><td>恢复重要参考帧（I帧）</td><td>恢复突发数据包、关键帧保护等</td></tr></tbody></table><h2 id=五实现细节>五、实现细节<a hidden class=anchor aria-hidden=true href=#五实现细节>#</a></h2><h3 id=1-rtp--fec模块结构>1. RTP + FEC模块结构<a hidden class=anchor aria-hidden=true href=#1-rtp--fec模块结构>#</a></h3><pre tabindex=0><code>【视频编码器】 → 【RTP打包】 ─────┐
                                │
                        ┌───────▼────────┐
                        │ FEC生成器（如FlexFEC）│
                        └───────┬────────┘
                                │
 原始RTP包  ────────────────────┼─→ 发送到网络
 冗余FEC包  ────────────────────┘

     ↙
【网络】
     ↘

【接收端RTP Demux】
        ↓           ↘
原始RTP包        FEC RTP包
   ↓                  ↓
【重传检测/NACK】   【FEC解码器】
   ↓                  ↓
      →→→→→→→→→→→→→→→→
      │              │
      ↓              ↓
【解码器 ← 重建帧 ← FEC还原】
</code></pre><h3 id=2-实现注意事项>2. 实现注意事项<a hidden class=anchor aria-hidden=true href=#2-实现注意事项>#</a></h3><ol><li>FEC属于RTP层，不影响H.264编码器</li><li>需要发送端和接收端都支持</li><li>通过SDP协商和C++配置启用</li><li>适合视频通话等实时场景</li></ol><h2 id=六总结>六、总结<a hidden class=anchor aria-hidden=true href=#六总结>#</a></h2><ol><li>NACK和FEC是视频传输中两种互补的丢包恢复机制</li><li>NACK适合低丢包、低延迟场景</li><li>FEC适合高丢包、高延迟场景</li><li>实际应用中常组合使用，根据网络状况动态调整</li><li>选择策略时需权衡带宽、延迟和恢复能力</li></ol><hr><p><em>参考文献：</em></p><ol><li>&ldquo;WebRTC: APIs and RTCWEB Protocols of the HTML5 Real-Time Web&rdquo; by Alan B. Johnston</li><li>&ldquo;Real-Time Communication with WebRTC&rdquo; by Salvatore Loreto</li><li>&ldquo;RTP: Audio and Video for the Internet&rdquo; by Colin Perkins</li><li>&ldquo;Video Coding for Mobile Communications&rdquo; by Mohammed Ghanbari</li><li>&ldquo;Digital Video Processing&rdquo; by A. Murat Tekalp</li><li>&ldquo;Video Compression and Communications&rdquo; by Lajos Hanzo</li><li>&ldquo;Network Performance Analysis&rdquo; by Thomas Bonald</li><li>&ldquo;Multimedia Communications&rdquo; by Fred Halsall</li><li>&ldquo;Streaming Media&rdquo; by Geoff Huston</li><li>&ldquo;Internetworking with TCP/IP&rdquo; by Douglas E. Comer</li></ol></div><footer class=post-footer><ul class=post-tags><li><a href=https://xuyafei.github.io/personal-site/tags/%E8%A7%86%E9%A2%91%E4%BC%A0%E8%BE%93/>视频传输</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/%E5%AE%9E%E6%97%B6%E9%80%9A%E4%BF%A1/>实时通信</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/%E7%BD%91%E7%BB%9C%E4%BC%A0%E8%BE%93/>网络传输</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/nack/>NACK</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/fec/>FEC</a></li><li><a href=https://xuyafei.github.io/personal-site/tags/webrtc/>WebRTC</a></li></ul><nav class=paginav><a class=prev href=https://xuyafei.github.io/personal-site/posts/audio_loss_recovery/><span class=title>« Prev</span><br><span>音频丢包恢复机制详解：PLC与FEC技术</span>
</a><a class=next href=https://xuyafei.github.io/personal-site/posts/cpp-class-vs-struct/><span class=title>Next »</span><br><span>全面解析C++中类(class)与结构体(struct)的区别</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on x" href="https://x.com/intent/tweet/?text=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3&amp;url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f&amp;hashtags=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%2c%e5%ae%9e%e6%97%b6%e9%80%9a%e4%bf%a1%2c%e7%bd%91%e7%bb%9c%e4%bc%a0%e8%be%93%2cNACK%2cFEC%2cWebRTC"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f&amp;title=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3&amp;summary=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3&amp;source=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f&title=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on whatsapp" href="https://api.whatsapp.com/send?text=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3%20-%20https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on telegram" href="https://telegram.me/share/url?text=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3&amp;url=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 视频传输中的丢包恢复机制：NACK与FEC详解 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%e8%a7%86%e9%a2%91%e4%bc%a0%e8%be%93%e4%b8%ad%e7%9a%84%e4%b8%a2%e5%8c%85%e6%81%a2%e5%a4%8d%e6%9c%ba%e5%88%b6%ef%bc%9aNACK%e4%b8%8eFEC%e8%af%a6%e8%a7%a3&u=https%3a%2f%2fxuyafei.github.io%2fpersonal-site%2fposts%2fvideo_loss_recovery%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://xuyafei.github.io/personal-site/>我的博客</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>